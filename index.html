<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Heist - Daily Mystery Word Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', 'Segoe UI', monospace;
            background: linear-gradient(135deg, #2c2416 0%, #1a1611 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(0deg,
                    transparent,
                    transparent 2px,
                    rgba(139, 106, 65, 0.03) 2px,
                    rgba(139, 106, 65, 0.03) 4px);
            pointer-events: none;
        }

        .game-container {
            background: linear-gradient(135deg, #f4e8d0 0%, #e8dcc0 100%);
            border-radius: 20px;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 0 20px rgba(139, 106, 65, 0.1);
            padding: 30px;
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.5s ease;
            border: 3px solid #3d2f1f;
            position: relative;
            overflow: visible;
        }

        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                repeating-linear-gradient(45deg,
                    transparent,
                    transparent 10px,
                    rgba(61, 47, 31, 0.02) 10px,
                    rgba(61, 47, 31, 0.02) 20px);
            border-radius: 20px;
            pointer-events: none;
        }

        /* Coffee stains */
        .coffee-stain {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(ellipse at center,
                    transparent 30%,
                    rgba(139, 106, 65, 0.08) 40%,
                    rgba(139, 106, 65, 0.12) 50%,
                    transparent 70%);
            pointer-events: none;
        }

        .coffee-stain-1 {
            top: 10px;
            right: 40px;
            transform: rotate(15deg) scale(1.2);
        }

        .coffee-stain-2 {
            bottom: 100px;
            left: 20px;
            transform: rotate(-30deg) scale(0.8);
        }

        /* Paper clip */
        .paper-clip {
            position: absolute;
            top: 15px;
            left: 30px;
            width: 30px;
            height: 60px;
            border: 3px solid #8b6a41;
            border-radius: 15px 15px 0 0;
            border-bottom: none;
            transform: rotate(-10deg);
            opacity: 0.6;
            pointer-events: none;
        }

        .paper-clip::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: -3px;
            width: 30px;
            height: 20px;
            border: 3px solid #8b6a41;
            border-radius: 0 0 10px 10px;
            border-top: none;
        }

        /* Red stamp effect */
        .evidence-stamp {
            position: absolute;
            top: 80px;
            right: 20px;
            color: #d32f2f;
            font-size: 14px;
            font-weight: bold;
            transform: rotate(25deg);
            border: 3px solid #d32f2f;
            padding: 5px 10px;
            border-radius: 5px;
            opacity: 0.5;
            text-transform: uppercase;
            letter-spacing: 2px;
            pointer-events: none;
        }

        /* Cigarette burns */
        .cigarette-burn {
            position: absolute;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            pointer-events: none;
            background: radial-gradient(circle at center,
                    rgba(20, 10, 0, 0.6) 0%,
                    rgba(60, 30, 10, 0.4) 30%,
                    rgba(100, 50, 20, 0.2) 60%,
                    transparent 100%);
            box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.8);
        }

        .burn-1 {
            top: 120px;
            left: 60px;
            transform: scale(0.8);
        }

        .burn-2 {
            bottom: 30px;
            right: 80px;
            transform: scale(1.1);
        }

        .burn-3 {
            top: 250px;
            right: 30px;
            transform: scale(0.9);
        }

        /* Ink splatters */
        .ink-splatter {
            position: absolute;
            pointer-events: none;
        }

        .ink-1 {
            top: 200px;
            left: 40px;
            width: 30px;
            height: 25px;
            background: radial-gradient(ellipse at center,
                    rgba(30, 25, 20, 0.4) 40%,
                    transparent 70%);
            transform: rotate(45deg) scale(1.5, 1);
        }

        .ink-1::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 10px;
            width: 8px;
            height: 8px;
            background: rgba(30, 25, 20, 0.3);
            border-radius: 50%;
        }

        .ink-1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 5px;
            width: 5px;
            height: 5px;
            background: rgba(30, 25, 20, 0.25);
            border-radius: 50%;
        }

        .ink-2 {
            bottom: 180px;
            right: 50px;
            width: 20px;
            height: 15px;
            background: radial-gradient(ellipse at center,
                    rgba(30, 25, 20, 0.3) 30%,
                    transparent 60%);
            transform: rotate(-30deg) scale(1.2, 0.8);
        }

        /* Folder tabs */
        .folder-tab {
            position: absolute;
            background: linear-gradient(135deg, #d4a574 0%, #c8986a 100%);
            padding: 5px 15px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #3d2f1f;
            pointer-events: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .folder-tab-1 {
            top: -15px;
            left: 50px;
            transform: perspective(50px) rotateX(20deg);
            border-radius: 5px 5px 0 0;
        }

        .folder-tab-2 {
            top: -15px;
            left: 150px;
            transform: perspective(50px) rotateX(20deg);
            border-radius: 5px 5px 0 0;
            background: linear-gradient(135deg, #e8b88a 0%, #d4a574 100%);
        }

        .folder-tab-3 {
            top: -15px;
            right: 80px;
            transform: perspective(50px) rotateX(20deg);
            border-radius: 5px 5px 0 0;
            background: linear-gradient(135deg, #c8986a 0%, #b8885a 100%);
        }

        /* Staple marks */
        .staple {
            position: absolute;
            top: 40px;
            left: 250px;
            width: 20px;
            height: 4px;
            background: linear-gradient(90deg,
                    #666 0%,
                    #999 50%,
                    #666 100%);
            transform: rotate(-5deg);
            box-shadow:
                0 1px 2px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            pointer-events: none;
        }

        .staple::before,
        .staple::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 8px;
            background: #666;
            top: 2px;
        }

        .staple::before {
            left: 2px;
        }

        .staple::after {
            right: 2px;
        }

        /* Typewriter ribbon effect */
        .ribbon-mark {
            position: absolute;
            bottom: 140px;
            left: 100px;
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    rgba(50, 40, 80, 0.1) 20%,
                    rgba(50, 40, 80, 0.2) 50%,
                    rgba(50, 40, 80, 0.1) 80%,
                    transparent 100%);
            transform: rotate(2deg);
            pointer-events: none;
        }

        /* Paper texture overlay */
        .paper-texture {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.3;
            pointer-events: none;
            border-radius: 20px;
            background-image:
                repeating-linear-gradient(90deg,
                    transparent,
                    transparent 3px,
                    rgba(139, 106, 65, 0.03) 3px,
                    rgba(139, 106, 65, 0.03) 6px),
                repeating-linear-gradient(0deg,
                    transparent,
                    transparent 3px,
                    rgba(139, 106, 65, 0.03) 3px,
                    rgba(139, 106, 65, 0.03) 6px);
        }

        /* Aged paper edges */
        .aged-edge {
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 20px;
            background: linear-gradient(135deg,
                    transparent 0%,
                    rgba(139, 106, 65, 0.05) 10%,
                    transparent 20%,
                    transparent 80%,
                    rgba(139, 106, 65, 0.05) 90%,
                    transparent 100%);
            pointer-events: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            color: #3d2f1f;
            font-size: 32px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            font-family: 'Courier New', monospace;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .badge {
            font-size: 28px;
            filter: sepia(0.5);
        }

        .case-info {
            background: linear-gradient(135deg, #3d2f1f 0%, #2c2416 100%);
            color: #f4e8d0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow:
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.2);
            border: 2px solid #8b6a41;
            position: relative;
            overflow: hidden;
        }

        .case-info::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(45deg,
                    transparent,
                    transparent 5px,
                    rgba(139, 106, 65, 0.1) 5px,
                    rgba(139, 106, 65, 0.1) 10px);
            animation: slide 20s linear infinite;
        }

        @keyframes slide {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(50px, 50px);
            }
        }

        .case-number {
            font-size: 14px;
            opacity: 0.9;
            font-family: 'Courier New', monospace;
            letter-spacing: 3px;
        }

        .case-title {
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            gap: 10px;
        }

        .stat-box {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #d4c4a8 0%, #c8b898 100%);
            border-radius: 10px;
            border: 2px solid #8b6a41;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #3d2f1f;
            font-family: 'Courier New', monospace;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3);
        }

        .stat-label {
            font-size: 12px;
            color: #5a4636;
            margin-top: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .letter-bank {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .letter {
            width: 50px;
            height: 50px;
            border: 2px solid #8b6a41;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #3d2f1f;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f4e8d0 0%, #e8dcc0 100%);
            user-select: none;
            box-shadow:
                0 3px 6px rgba(0, 0, 0, 0.2),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
            font-family: 'Courier New', monospace;
        }

        .letter:hover {
            transform: translateY(-5px);
            box-shadow:
                0 8px 12px rgba(0, 0, 0, 0.3),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #f9edD5 0%, #ede1c5 100%);
        }

        .letter.selected {
            background: linear-gradient(135deg, #8b6a41 0%, #6b5331 100%);
            color: #f4e8d0;
            transform: scale(0.9);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .word-input {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 20px;
            min-height: 50px;
            padding: 10px;
            background: linear-gradient(135deg, #d4c4a8 0%, #c8b898 100%);
            border-radius: 10px;
            flex-wrap: wrap;
            border: 2px solid #8b6a41;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .word-letter {
            width: 40px;
            height: 40px;
            border: 2px dashed #8b6a41;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #3d2f1f;
            transition: all 0.3s ease;
            background: rgba(244, 232, 208, 0.5);
            font-family: 'Courier New', monospace;
        }

        .word-letter.filled {
            border-style: solid;
            border-color: #5a4636;
            background: #f4e8d0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn {
            background: linear-gradient(135deg, #2a5a2a 0%, #1d3d1d 100%);
            color: #f4e8d0;
            box-shadow:
                0 4px 6px rgba(0, 0, 0, 0.3),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow:
                0 6px 12px rgba(0, 0, 0, 0.4),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #326432 0%, #254725 100%);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(135deg, #5a4636 0%, #483828 100%);
        }

        .clear-btn {
            background: linear-gradient(135deg, #8b6a41 0%, #6b5331 100%);
            color: #f4e8d0;
            box-shadow:
                0 4px 6px rgba(0, 0, 0, 0.2),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .clear-btn:hover {
            background: linear-gradient(135deg, #9b7a51 0%, #7b6341 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
        }

        .hint-btn {
            background: linear-gradient(135deg, #8b4513 0%, #6b3410 100%);
            color: #f4e8d0;
            box-shadow:
                0 4px 6px rgba(0, 0, 0, 0.2),
                inset 0 -2px 4px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #9b5523 0%, #7b4420 100%);
        }

        .found-words {
            background: linear-gradient(135deg, #d4c4a8 0%, #c8b898 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #8b6a41;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .found-words-title {
            font-size: 16px;
            font-weight: bold;
            color: #3d2f1f;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .words-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .found-word {
            background: #f4e8d0;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: #3d2f1f;
            border: 2px solid #8b6a41;
            animation: wordFound 0.5s ease;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @keyframes wordFound {
            from {
                transform: scale(0);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .mystery-clue {
            background: linear-gradient(135deg, #8b4513 0%, #6b3410 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: #f4e8d0;
            border: 2px solid #d4a574;
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .mystery-clue::before {
            content: 'TOP SECRET';
            position: absolute;
            top: -10px;
            right: 20px;
            background: #d32f2f;
            color: white;
            padding: 2px 8px;
            font-size: 10px;
            font-weight: bold;
            transform: rotate(3deg);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .clue-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.9;
        }

        .clue-text {
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 3px;
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            color: #f4e8d0;
            animation: slideDown 0.5s ease;
            z-index: 1000;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100px);
            }

            to {
                transform: translateX(-50%) translateY(0);
            }
        }

        .message.success {
            background: linear-gradient(135deg, #2a5a2a 0%, #1d3d1d 100%);
            border: 2px solid #4a7a4a;
        }

        .message.error {
            background: linear-gradient(135deg, #8b2020 0%, #6b1515 100%);
            border: 2px solid #bb4040;
        }

        .message.info {
            background: linear-gradient(135deg, #3d2f1f 0%, #2c2416 100%);
            border: 2px solid #8b6a41;
        }

        .timer {
            text-align: center;
            margin-bottom: 15px;
            font-size: 14px;
            color: #5a4636;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #c8b898;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid #8b6a41;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b4513 0%, #6b3410 100%);
            transition: width 0.3s ease;
            box-shadow: inset 0 -2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Case Closed Stamp Animation */
        .case-closed-stamp {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(5) rotate(-15deg);
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            animation: stampSlam 1.5s ease-out forwards;
        }

        .stamp-container {
            background: #d32f2f;
            padding: 20px 40px;
            border-radius: 10px;
            border: 5px solid #8b0000;
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 2px 0 rgba(255, 255, 255, 0.2),
                inset 0 -2px 0 rgba(0, 0, 0, 0.3);
            position: relative;
            transform: perspective(500px) rotateX(10deg);
        }

        .stamp-text {
            color: #fff;
            font-size: 48px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 8px;
            text-shadow:
                2px 2px 4px rgba(0, 0, 0, 0.5),
                -1px -1px 0 rgba(139, 0, 0, 1);
            white-space: nowrap;
        }

        .stamp-container::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 3px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
        }

        .stamp-container::after {
            content: '★ ★ ★';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #8b0000;
            font-size: 20px;
            letter-spacing: 10px;
        }

        @keyframes stampSlam {
            0% {
                transform: translate(-50%, -50%) scale(5) rotate(-15deg);
                opacity: 0;
            }

            40% {
                transform: translate(-50%, -50%) scale(1.2) rotate(-12deg);
                opacity: 1;
            }

            50% {
                transform: translate(-50%, -50%) scale(0.9) rotate(-10deg);
            }

            60% {
                transform: translate(-50%, -50%) scale(1.05) rotate(-11deg);
            }

            70% {
                transform: translate(-50%, -50%) scale(0.98) rotate(-10deg);
            }

            80%,
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(-10deg);
                opacity: 1;
            }
        }

        /* Screen shake effect */
        @keyframes screenShake {

            0%,
            100% {
                transform: translate(0, 0);
            }

            10% {
                transform: translate(-5px, -5px);
            }

            20% {
                transform: translate(5px, -5px);
            }

            30% {
                transform: translate(-5px, 5px);
            }

            40% {
                transform: translate(5px, 5px);
            }

            50% {
                transform: translate(-3px, -3px);
            }

            60% {
                transform: translate(3px, -3px);
            }

            70% {
                transform: translate(-3px, 3px);
            }

            80% {
                transform: translate(3px, 3px);
            }

            90% {
                transform: translate(-1px, -1px);
            }
        }

        .shake-screen {
            animation: screenShake 0.5s ease-out;
        }

        /* Confetti effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #d4a574;
            pointer-events: none;
            z-index: 1999;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Victory overlay */
        .victory-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center,
                    transparent 0%,
                    rgba(0, 0, 0, 0.3) 50%,
                    rgba(0, 0, 0, 0.6) 100%);
            z-index: 1998;
            opacity: 0;
            pointer-events: none;
            animation: fadeInOverlay 0.5s ease-out forwards;
        }

        @keyframes fadeInOverlay {
            to {
                opacity: 1;
            }
        }

        /* Case details that appear after stamp */
        .case-complete-details {
            position: fixed;
            top: 65%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2001;
            opacity: 0;
            animation: fadeInDetails 0.5s ease-out 1.2s forwards;
            text-align: center;
            color: #f4e8d0;
            font-family: 'Courier New', monospace;
        }

        .case-complete-title {
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .case-complete-score {
            font-size: 32px;
            font-weight: bold;
            color: #d4a574;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 20px;
        }

        .case-complete-button {
            background: linear-gradient(135deg, #3d2f1f 0%, #2c2416 100%);
            color: #f4e8d0;
            padding: 15px 30px;
            border: 2px solid #8b6a41;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .case-complete-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.7);
            background: linear-gradient(135deg, #4d3f2f 0%, #3c3426 100%);
        }

        @keyframes fadeInDetails {
            to {
                opacity: 1;
            }
        }

        .auth-section {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #d4c4a8 0%, #c8b898 100%);
            border-radius: 10px;
            border: 2px solid #8b6a41;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .auth-btn {
            background: linear-gradient(135deg, #3d2f1f 0%, #2c2416 100%);
            color: #f4e8d0;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 5px;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #4d3f2f 0%, #3c3426 100%);
        }

        .user-info {
            font-size: 14px;
            color: #3d2f1f;
            font-family: 'Courier New', monospace;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #f4e8d0 0%, #e8dcc0 100%);
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            animation: slideUp 0.3s ease;
            border: 3px solid #3d2f1f;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #8b6a41;
            border-radius: 8px;
            font-size: 16px;
            background: #f9f3e9;
            color: #3d2f1f;
            font-family: 'Courier New', monospace;
        }

        .modal input:focus {
            outline: none;
            border-color: #5a4636;
            box-shadow: 0 0 5px rgba(139, 106, 65, 0.3);
        }

        .modal h2 {
            color: #3d2f1f;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .close-modal {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #8b6a41;
            font-weight: bold;
        }

        .close-modal:hover {
            color: #5a4636;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <!-- Visual effects layer 1 -->
        <div class="aged-edge"></div>
        <div class="paper-texture"></div>

        <!-- Coffee stains -->
        <div class="coffee-stain coffee-stain-1"></div>
        <div class="coffee-stain coffee-stain-2"></div>

        <!-- Cigarette burns -->
        <div class="cigarette-burn burn-1"></div>
        <div class="cigarette-burn burn-2"></div>
        <div class="cigarette-burn burn-3"></div>

        <!-- Ink splatters -->
        <div class="ink-splatter ink-1"></div>
        <div class="ink-splatter ink-2"></div>

        <!-- Office supplies -->
        <div class="paper-clip"></div>
        <div class="staple"></div>
        <div class="ribbon-mark"></div>

        <!-- Folder tabs -->
        <div class="folder-tab folder-tab-1">URGENT</div>
        <div class="folder-tab folder-tab-2">CASE</div>
        <div class="folder-tab folder-tab-3">1947</div>

        <!-- Stamps -->
        <div class="evidence-stamp">EVIDENCE</div>

        <div class="header">
            <h1><span class="badge">🕵️</span> Word Heist</h1>
        </div>

        <!-- Audio controls -->
        <div style="position: absolute; top: 10px; right: 10px; z-index: 10;">
            <button onclick="toggleSound()" style="background: none; border: none; cursor: pointer; font-size: 20px;"
                id="soundBtn">🔊</button>
        </div>

        <!-- Authentication Section -->
        <div class="auth-section" id="authSection">
            <div id="loggedOut" style="display: none;">
                <p>Sign in to save your progress and compete on leaderboards!</p>
                <button class="auth-btn" onclick="showLoginModal()">Login</button>
                <button class="auth-btn" onclick="showRegisterModal()">Register</button>
            </div>
            <div id="loggedIn" style="display: none;">
                <div class="user-info">
                    Welcome, <strong id="username">Detective</strong>!
                    <button class="auth-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <div class="case-info">
            <div class="case-number" id="caseNumber">CASE #001</div>
            <div class="case-title" id="caseTitle">The Maltese Mystery</div>
        </div>

        <div class="stats-row">
            <div class="stat-box">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">POINTS</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="streak">0</div>
                <div class="stat-label">STREAK</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="hints">3</div>
                <div class="stat-label">HINTS</div>
            </div>
        </div>

        <div class="timer" id="timer">Time: 0:00</div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%"></div>
        </div>

        <div class="mystery-clue">
            <div class="clue-title">MYSTERY WORD CLUE</div>
            <div class="clue-text" id="mysteryClue">? ? ? ? ? ?</div>
        </div>

        <div class="letter-bank" id="letterBank"></div>

        <div class="word-input" id="wordInput"></div>

        <div class="controls">
            <button class="clear-btn" onclick="clearWord()">Clear</button>
            <button class="hint-btn" onclick="useHint()">Use Hint</button>
            <button class="submit-btn" id="submitBtn" onclick="submitWord()" disabled>Submit</button>
        </div>

        <div class="found-words">
            <div class="found-words-title">Evidence Collected (<span id="wordCount">0</span>/10)</div>
            <div class="words-list" id="foundWords"></div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Login</h2>
            <form id="authForm" onsubmit="handleAuth(event)">
                <input type="text" id="authUsername" placeholder="Username" style="display: none;">
                <input type="email" id="authEmail" placeholder="Email" required>
                <input type="password" id="authPassword" placeholder="Password" required>
                <button type="submit" class="submit-btn" style="width: 100%; margin-top: 10px;">Submit</button>
            </form>
        </div>
    </div>

    <script>
        // ============= SOUND SYSTEM =============
        let soundEnabled = true;

        // Create audio context for sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // Sound effect functions
        function playTypewriterSound() {
            if (!soundEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'square';
            gainNode.gain.value = 0.1;

            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.05);
        }

        function playPaperSound() {
            if (!soundEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();

            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            filter.type = 'highpass';
            filter.frequency.value = 1000;

            oscillator.type = 'sawtooth';
            oscillator.frequency.value = 100 + Math.random() * 50;

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function playSuccessSound() {
            if (!soundEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5

            gainNode.gain.value = 0.3;
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function playErrorSound() {
            if (!soundEnabled) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'sawtooth';
            oscillator.frequency.value = 200;
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);

            gainNode.gain.value = 0.2;
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        function playStampSound() {
            if (!soundEnabled) return;

            // Create a deep thud sound
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();

            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            filter.type = 'lowpass';
            filter.frequency.value = 200;

            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(60, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(20, audioContext.currentTime + 0.3);

            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);

            // Add a metallic ring
            const ring = audioContext.createOscillator();
            const ringGain = audioContext.createGain();

            ring.connect(ringGain);
            ringGain.connect(audioContext.destination);

            ring.type = 'triangle';
            ring.frequency.value = 1500;

            ringGain.gain.setValueAtTime(0.1, audioContext.currentTime);
            ringGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            ring.start(audioContext.currentTime + 0.05);
            ring.stop(audioContext.currentTime + 0.5);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').textContent = soundEnabled ? '🔊' : '🔇';
        }

        // ============= NOIR CASE TITLES =============
        const noirCaseTitles = [
            "The Maltese Mystery",
            "The Big Word Sleep",
            "Casablanca Cipher",
            "The Third Letter",
            "Sunset Boulevard Scramble",
            "The Postman Always Spells Twice",
            "Touch of Vowels",
            "The Letter Wore Black",
            "Double Indemnity Dictionary",
            "The Asphalt Anagram",
            "Chinatown Challenge",
            "The Long Goodbye Letters",
            "Key Largo Kryptic",
            "The Killing Words",
            "Out of the Past Puzzle",
            "The Lady from Shanghai Shuffle",
            "Notorious Nomenclature",
            "The Strange Love of Letter A",
            "Kiss Me Deadly Definitions",
            "Night and the City Cipher",
            "The Naked City Narrative",
            "White Heat Words",
            "The Breaking Point Palindrome",
            "Pickup on South Street Spelling",
            "The Night of the Hunter Hints",
            "Rififi Riddle",
            "The Sweet Smell of Success Syllables",
            "Vertigo Vocabulary",
            "The Wrong Man's Words",
            "Anatomy of a Murder Mystery"
        ];

        function getNoirCaseTitle(caseNumber) {
            const index = (caseNumber - 1) % noirCaseTitles.length;
            return noirCaseTitles[index];
        }

        // ============= API CONFIGURATION =============
        const API_URL = 'wordheist-production.up.railway.app/api';  // Replace with your Railway URL
        // For local testing use: 'http://localhost:5000/api'

        // API Helper Class
        class WordHeistAPI {
            constructor() {
                this.baseURL = API_URL;
                this.token = localStorage.getItem('wordheist_token');
                this.user = JSON.parse(localStorage.getItem('wordheist_user') || 'null');
            }

            async request(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                const config = {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers,
                    }
                };

                if (this.token) {
                    config.headers['Authorization'] = `Bearer ${this.token}`;
                }

                try {
                    const response = await fetch(url, config);
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error || 'API request failed');
                    return data;
                } catch (error) {
                    console.error('API Error:', error);
                    throw error;
                }
            }

            async getDailyPuzzle() {
                return await this.request('/daily-puzzle');
            }

            async validateWord(word, puzzleId) {
                return await this.request('/validate-word', {
                    method: 'POST',
                    body: JSON.stringify({ word, puzzle_id: puzzleId })
                });
            }

            async login(email, password) {
                const data = await this.request('/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                this.token = data.token;
                this.user = data.user;
                localStorage.setItem('wordheist_token', this.token);
                localStorage.setItem('wordheist_user', JSON.stringify(this.user));
                return data;
            }

            async register(username, email, password) {
                const data = await this.request('/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, email, password })
                });
                this.token = data.token;
                this.user = data.user;
                localStorage.setItem('wordheist_token', this.token);
                localStorage.setItem('wordheist_user', JSON.stringify(this.user));
                return data;
            }

            isAuthenticated() {
                return !!this.token;
            }
        }

        // Initialize API
        const api = new WordHeistAPI();

        // Game state
        let gameState = {
            letters: ['C', 'R', 'I', 'M', 'E', 'S'],
            currentWord: [],
            foundWords: [],
            score: 0,
            hints: 3,
            streak: parseInt(localStorage.getItem('streak') || 0),
            startTime: Date.now(),
            mysteryWord: 'CRIMES',
            mysteryProgress: 0,
            puzzleId: null,  // Added for API
            isOnline: false,  // Added for API
            caseNumber: 1
        };

        // Valid words dictionary (simplified for demo)
        const validWords = {
            3: ['ICE', 'SIR', 'RIM', 'IRE'],
            4: ['RICE', 'MICE', 'CRIS', 'RIME', 'SEMI', 'ICES'],
            5: ['CRIME', 'CRIES', 'RICES', 'MISER'],
            6: ['CRIMES']
        };

        // Initialize game - Enhanced with API
        async function initGame() {
            // Set noir case title
            const caseNumber = Math.floor(Math.random() * 999) + 1;
            gameState.caseNumber = caseNumber;
            document.getElementById('caseNumber').textContent = `CASE #${String(caseNumber).padStart(3, '0')}`;
            document.getElementById('caseTitle').textContent = getNoirCaseTitle(caseNumber);

            try {
                // Try to get daily puzzle from API
                const puzzleData = await api.getDailyPuzzle();
                if (puzzleData && puzzleData.puzzle) {
                    gameState.letters = puzzleData.puzzle.letters;
                    gameState.puzzleId = puzzleData.puzzle.id;
                    gameState.isOnline = true;
                    gameState.mysteryWord = '?'.repeat(puzzleData.puzzle.mystery_length);

                    // Update case info from API if available
                    if (puzzleData.puzzle.case_number) {
                        gameState.caseNumber = puzzleData.puzzle.case_number;
                        document.getElementById('caseNumber').textContent = `CASE #${String(puzzleData.puzzle.case_number).padStart(3, '0')}`;
                        document.getElementById('caseTitle').textContent = getNoirCaseTitle(puzzleData.puzzle.case_number);
                    }

                    // Restore user progress if available
                    if (puzzleData.user_progress) {
                        gameState.foundWords = puzzleData.user_progress.found_words;
                        gameState.score = puzzleData.user_progress.current_score;
                    }

                    showMessage('Connected to server!', 'success');
                }
            } catch (error) {
                console.log('Running in offline mode');
                gameState.isOnline = false;
            }

            renderLetters();
            updateDisplay();
            updateStreak();
            startTimer();

            // Play ambient typewriter sound on load
            setTimeout(() => playTypewriterSound(), 500);
        }

        function renderLetters() {
            const letterBank = document.getElementById('letterBank');
            letterBank.innerHTML = '';

            gameState.letters.forEach((letter, index) => {
                const letterEl = document.createElement('div');
                letterEl.className = 'letter';
                letterEl.textContent = letter;
                letterEl.onclick = () => selectLetter(index);
                letterEl.id = `letter-${index}`;
                letterBank.appendChild(letterEl);
            });
        }

        function selectLetter(index) {
            const letter = gameState.letters[index];
            const letterEl = document.getElementById(`letter-${index}`);

            // Play typewriter sound
            playTypewriterSound();

            if (letterEl.classList.contains('selected')) {
                // Deselect
                const wordIndex = gameState.currentWord.findIndex(l => l.index === index);
                if (wordIndex !== -1) {
                    gameState.currentWord.splice(wordIndex, 1);
                    letterEl.classList.remove('selected');
                }
            } else {
                // Select
                gameState.currentWord.push({ letter, index });
                letterEl.classList.add('selected');
            }

            updateWordInput();
            updateSubmitButton();
        }

        function updateWordInput() {
            const wordInput = document.getElementById('wordInput');
            wordInput.innerHTML = '';

            if (gameState.currentWord.length === 0) {
                wordInput.innerHTML = '<div class="word-letter"></div>';
                return;
            }

            gameState.currentWord.forEach(({ letter }) => {
                const letterEl = document.createElement('div');
                letterEl.className = 'word-letter filled';
                letterEl.textContent = letter;
                wordInput.appendChild(letterEl);
            });
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = gameState.currentWord.length < 3;
        }

        function clearWord() {
            playPaperSound(); // Paper shuffle sound
            gameState.currentWord.forEach(({ index }) => {
                document.getElementById(`letter-${index}`).classList.remove('selected');
            });
            gameState.currentWord = [];
            updateWordInput();
            updateSubmitButton();
        }

        async function submitWord() {
            const word = gameState.currentWord.map(l => l.letter).join('');

            // If online and authenticated, use API validation
            if (gameState.isOnline && api.isAuthenticated() && gameState.puzzleId) {
                try {
                    const result = await api.validateWord(word, gameState.puzzleId);

                    if (result.valid && !result.duplicate) {
                        gameState.foundWords = result.found_words;
                        gameState.score = result.current_score;

                        updateFoundWords();
                        updateDisplay();
                        showMessage(`+${result.points} points!`, 'success');
                        playSuccessSound();

                        if (result.is_mystery) {
                            solveMystery();
                        } else {
                            updateMysteryClue();
                        }

                        clearWord();

                        if (result.completed) {
                            setTimeout(winGame, 500);
                        }
                    } else if (result.duplicate) {
                        showMessage('Already found!', 'error');
                        playErrorSound();
                    } else {
                        showMessage('Not a valid word!', 'error');
                        playErrorSound();
                    }
                    return;
                } catch (error) {
                    console.log('API validation failed, using offline mode');
                }
            }

            // Offline validation (original code)
            if (gameState.foundWords.includes(word)) {
                showMessage('Already found!', 'error');
                playErrorSound();
                return;
            }

            let isValid = false;
            for (let length in validWords) {
                if (validWords[length].includes(word)) {
                    isValid = true;
                    break;
                }
            }

            if (isValid) {
                gameState.foundWords.push(word);
                gameState.score += word.length * 10;
                playSuccessSound();

                if (word === gameState.mysteryWord) {
                    solveMystery();
                } else {
                    updateMysteryClue();
                }

                updateFoundWords();
                updateDisplay();
                showMessage(`+${word.length * 10} points!`, 'success');
                clearWord();

                if (gameState.foundWords.length >= 10 || gameState.foundWords.includes(gameState.mysteryWord)) {
                    setTimeout(winGame, 500);
                }
            } else {
                showMessage('Not a valid word!', 'error');
                playErrorSound();
            }
        }

        function updateMysteryClue() {
            const progress = Math.floor((gameState.foundWords.length / 10) * gameState.mysteryWord.length);
            let clueText = '';

            for (let i = 0; i < gameState.mysteryWord.length; i++) {
                if (i < progress) {
                    clueText += gameState.mysteryWord[i] + ' ';
                } else {
                    clueText += '? ';
                }
            }

            document.getElementById('mysteryClue').textContent = clueText.trim();

            // Update progress bar
            const progressPercent = (gameState.foundWords.length / 10) * 100;
            document.getElementById('progress').style.width = progressPercent + '%';
        }

        function solveMystery() {
            document.getElementById('mysteryClue').textContent = gameState.mysteryWord;
            gameState.score += 100;
            showMessage('Mystery Solved! +100 points!', 'success');
        }

        function useHint() {
            if (gameState.hints <= 0) {
                showMessage('No hints remaining!', 'error');
                playErrorSound();
                return;
            }

            playPaperSound(); // Paper shuffle for hint reveal

            // Find a word not yet found
            let hintWord = null;
            for (let length in validWords) {
                for (let word of validWords[length]) {
                    if (!gameState.foundWords.includes(word)) {
                        hintWord = word;
                        break;
                    }
                }
                if (hintWord) break;
            }

            if (hintWord) {
                showMessage(`Try finding: ${hintWord}`, 'info');
                gameState.hints--;
                updateDisplay();
            }
        }

        function updateFoundWords() {
            const foundWordsEl = document.getElementById('foundWords');
            foundWordsEl.innerHTML = '';

            gameState.foundWords.forEach(word => {
                const wordEl = document.createElement('div');
                wordEl.className = 'found-word';
                wordEl.textContent = word;
                foundWordsEl.appendChild(wordEl);
            });

            document.getElementById('wordCount').textContent = gameState.foundWords.length;
        }

        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('hints').textContent = gameState.hints;
        }

        function updateStreak() {
            document.getElementById('streak').textContent = gameState.streak;
        }

        function startTimer() {
            setInterval(() => {
                const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function showMessage(text, type) {
            const existing = document.querySelector('.message');
            if (existing) existing.remove();

            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            document.body.appendChild(message);

            setTimeout(() => message.remove(), 3000);
        }

        function winGame() {
            const time = Math.floor((Date.now() - gameState.startTime) / 1000);
            const timeBonus = Math.max(0, 300 - time) * 2;
            gameState.score += timeBonus;

            // Update streak
            gameState.streak++;
            localStorage.setItem('streak', gameState.streak);

            updateDisplay();

            // Create dramatic case closed animation
            showCaseClosedStamp(gameState.score, timeBonus);
        }

        function showCaseClosedStamp(finalScore, timeBonus) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'victory-overlay';
            document.body.appendChild(overlay);

            // Create stamp
            const stamp = document.createElement('div');
            stamp.className = 'case-closed-stamp';
            stamp.innerHTML = `
                <div class="stamp-container">
                    <div class="stamp-text">CASE CLOSED</div>
                </div>
            `;
            document.body.appendChild(stamp);

            // Add screen shake
            document.querySelector('.game-container').classList.add('shake-screen');

            // Play stamp sound after a short delay
            setTimeout(() => {
                playStampSound();

                // Remove screen shake
                setTimeout(() => {
                    document.querySelector('.game-container').classList.remove('shake-screen');
                }, 500);
            }, 400);

            // Create confetti
            createConfetti();

            // Show case complete details
            setTimeout(() => {
                const details = document.createElement('div');
                details.className = 'case-complete-details';
                details.innerHTML = `
                    <div class="case-complete-title">Detective Work Complete!</div>
                    <div class="case-complete-score">Final Score: ${finalScore}</div>
                    <div class="case-complete-score" style="font-size: 20px; color: #8b6a41;">Time Bonus: +${timeBonus}</div>
                    <button class="case-complete-button" onclick="nextCase()">Next Case →</button>
                `;
                document.body.appendChild(details);
            }, 1500);
        }

        function createConfetti() {
            const colors = ['#d4a574', '#8b6a41', '#3d2f1f', '#f4e8d0', '#d32f2f'];

            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (2 + Math.random() * 3) + 's';
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animation = `confettiFall ${3 + Math.random() * 2}s linear`;
                    document.body.appendChild(confetti);

                    // Remove confetti after animation
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 30);
            }
        }

        function nextCase() {
            // Clean up victory elements
            document.querySelectorAll('.victory-overlay, .case-closed-stamp, .case-complete-details, .confetti').forEach(el => el.remove());

            // In a real game, this would load the next puzzle
            // For now, reload the page
            location.reload();
        }

        // Initialize on load
        initGame();
        updateAuthUI();

        // ============= AUTHENTICATION FUNCTIONS =============
        function updateAuthUI() {
            const loggedOut = document.getElementById('loggedOut');
            const loggedIn = document.getElementById('loggedIn');

            if (api.isAuthenticated() && api.user) {
                loggedOut.style.display = 'none';
                loggedIn.style.display = 'block';
                document.getElementById('username').textContent = api.user.username;
            } else {
                loggedOut.style.display = 'block';
                loggedIn.style.display = 'none';
            }
        }

        function showLoginModal() {
            document.getElementById('authModal').classList.add('active');
            document.getElementById('modalTitle').textContent = 'Login';
            document.getElementById('authUsername').style.display = 'none';
            document.getElementById('authUsername').required = false;
        }

        function showRegisterModal() {
            document.getElementById('authModal').classList.add('active');
            document.getElementById('modalTitle').textContent = 'Register';
            document.getElementById('authUsername').style.display = 'block';
            document.getElementById('authUsername').required = true;
        }

        function closeModal() {
            document.getElementById('authModal').classList.remove('active');
        }

        async function handleAuth(event) {
            event.preventDefault();

            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const username = document.getElementById('authUsername').value;
            const isRegister = document.getElementById('modalTitle').textContent === 'Register';

            try {
                if (isRegister) {
                    await api.register(username, email, password);
                    showMessage('Registration successful!', 'success');
                } else {
                    await api.login(email, password);
                    showMessage('Login successful!', 'success');
                }

                closeModal();
                updateAuthUI();
                initGame(); // Reload game with user data

            } catch (error) {
                showMessage(error.message, 'error');
            }
        }

        function logout() {
            api.token = null;
            api.user = null;
            localStorage.removeItem('wordheist_token');
            localStorage.removeItem('wordheist_user');
            updateAuthUI();
            showMessage('Logged out successfully', 'info');
        }
    </script>
</body>

</html>